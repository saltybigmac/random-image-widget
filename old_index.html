<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Random Image</title>
  <style>
    html, body { height: 100%; margin: 0; }
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .wrap { width: min(1200px, 96vw); height: min(90vh, 900px); display: grid; gap: 12px; }
    .imgbox {
      display: flex; align-items: center; justify-content: center;
      border-radius: 16px; overflow: hidden;
    }
    img { width: 100%; height: 100%; object-fit: contain; }
    .bar { display:flex; gap: 10px; align-items:center; justify-content: space-between; }
    button {
      border: 0; border-radius: 999px; padding: 10px 14px; cursor: pointer;
    }
    .meta { opacity: 0.75; font-size: 14px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="bar">
      <button id="reroll">Show next</button>
      <div class="meta" id="status"></div>
      <button id="reset">Reset deck</button>
    </div>
    <div class="imgbox">
      <img id="img" alt="Random image" />
    </div>
  </div>

  <script>
    const IMAGES = [
      "images/1.jpeg",
      "images/2.jpeg",
      "images/3.jpeg",
      "images/4.jpeg",
      "images/5.jpeg",
      "images/6.jpeg",
      "images/7.jpeg",
      "images/8.jpeg",
      "images/9.jpeg",
      "images/10.jpeg",
      "images/11.jpeg",
      "images/12.jpeg",
      "images/13.jpg",
      "images/14.jpg",
      "images/15.jpg",
      "images/16.jpg",
      "images/17.jpg",
      "images/18.jpg",
      "images/19.jpg",
      "images/20.jpg",
      "images/21.jpg",
      "images/22.jpg",
      "images/23.jpg",
      "images/24.jpg",
      "images/25.jpg",
      "images/26.jpg",
      "images/27.jpg",
      "images/28.jpg",
      "images/29.jpg",
    ];

    const STORAGE_KEY = "random_image_no_repeat_v1";

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return null;
        const parsed = JSON.parse(raw);
        if (!parsed || !Array.isArray(parsed.deck) || typeof parsed.idx !== "number") return null;
        if (parsed.deck.length !== IMAGES.length) return null;
        const a = [...parsed.deck].sort().join("|");
        const b = [...IMAGES].sort().join("|");
        if (a !== b) return null;
        return parsed;
      } catch {
        return null;
      }
    }

    function saveState(state) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function newDeck() {
      return { deck: shuffle([...IMAGES]), idx: 0 };
    }

    function pickNext() {
      let state = loadState() || newDeck();

      if (state.idx >= state.deck.length) {
        state = newDeck();
      }

      const chosen = state.deck[state.idx];
      state.idx += 1;
      saveState(state);

      const img = document.getElementById("img");
      img.src = chosen + "?v=" + Date.now();

      document.getElementById("status").textContent =
        `Shown ${state.idx}/${state.deck.length} (no repeats)`;
    }

    document.getElementById("reroll").addEventListener("click", pickNext);
    document.getElementById("reset").addEventListener("click", () => {
      localStorage.removeItem(STORAGE_KEY);
      pickNext();
    });

    pickNext();
  </script>
</body>
</html>
